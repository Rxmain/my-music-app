let nameInputForm=document.querySelector(".user-search"),form=document.querySelector("form");const result=document.querySelector(".result-section"),resultNumber=document.querySelector(".result-section_counter"),userInput=document.querySelector(".user-search").value,select=document.querySelector("select"),selectBoxArtist=document.querySelector("select").value="artist",selectBoxTitle=document.querySelector("select").value="title",selectBoxAlbum=document.querySelector("select").value="album";let spinner=document.querySelector(".spinner"),resultSection=document.querySelector(".result-section"),mainResult=document.querySelector(".result-section_single"),idResult=document.querySelector(".id-single"),artistContent=document.querySelector(".artist-name"),titleContent=document.querySelector(".artist-single"),artistIdSearched="",showMoreDiv=document.querySelector(".more-btn"),showMore=document.querySelector(".show-more-btn"),offset=0;var handler;let mainResultDelete,childCopy,number=0,idSingle="",albumId="";function enterSubmit(){form.addEventListener("keypress",function(e){e.preventDefault(),13==e.key&&e.preventDefault()})}function searchByArtist(){let h=nameInputForm.value;function t(){showMoreDiv.style.display="block",function(t,n){const l=new XMLHttpRequest;l.open("GET","https://musicbrainz.org/ws/2/recording?fmt=json&limit=5&offset="+offset+"&artist="+artistIdSearched+"&inc=genres"),l.addEventListener("readystatechange",function(){var e;l.readyState===XMLHttpRequest.DONE&&(200===l.status?(e=JSON.parse(l.responseText),t(e)):n())}),l.send()}(function(d){resultNumber.textContent=d["recording-count"]+" résultats";for(let a=0;a<d.recordings.length;a++){number++;let t=childCopy;t=mainResult.cloneNode(!0);let e=t.children[4].children[0],n=t.children[4].children[1],l=t.children[4].children[1].firstElementChild,r=document.createElement("span");r.classList.add("closing"),r.textContent="Fermer",l.appendChild(r);let s=document.createElement("p");s.textContent="Artist: "+h,l.appendChild(s);let o=document.createElement("p");void 0!==d.recordings[a].genres[0]?o.textContent="Genre: "+d.recordings[a].genres[0].name:o.textContent="Genre: Inconnu",l.appendChild(o);let i=document.createElement("p");l.appendChild(i);let c=document.createElement("p");var u=d.recordings[a].length;c.textContent="Length: "+(m=u,p=void 0,p=Math.floor(m/6e4),m=(m%6e4/1e3).toFixed(0),p+":"+(m<10?"0":"")+m),l.appendChild(c),t.children[0].textContent=number,t.children[1].textContent=h,t.children[2].textContent=d.recordings[a].title,r.onclick=function(){n.style.display="none"},window.onclick=function(e){e.target==n&&(n.style.display="none")},e.onclick=function(e){e.preventDefault(),n.style.display="block"},idSingle=d.recordings[a].id,function(t,n){const l=new XMLHttpRequest;l.open("GET","https://musicbrainz.org/ws/2/release?fmt=json&limit=5&offset=&recording="+idSingle),l.addEventListener("readystatechange",function(){var e;l.readyState===XMLHttpRequest.DONE&&(200===l.status?(e=JSON.parse(l.responseText),t(e)):n())}),l.send()}(function(e){albumId=e.releases[0],null==albumId?t.children[3].textContent="Album inconnu":(albumId=e.releases[0].id,t.children[3].textContent=e.releases[0].title,i.textContent="Album: "+e.releases[0].title),function(t){const n=new XMLHttpRequest;n.open("GET","http://coverartarchive.org/release/"+albumId+"/"),n.setRequestHeader("Accept","application/json"),n.addEventListener("readystatechange",function(){var e;n.readyState===XMLHttpRequest.DONE&&(200===n.status?(e=JSON.parse(n.responseText),t(e)):console.log("Couverture d'album manquante"))}),n.send()}(function(n){for(let t=0;t<n.images.length;t++){let e=document.createElement("img");e.classList.add("image-album"),e.src=n.images[t].image,l.appendChild(e)}})}),resultSection.appendChild(t)}var m,p})}!function(t,n){const l=new XMLHttpRequest;l.open("GET",'http://musicbrainz.org/ws/2/artist/?query=artist:"'+h+'"'),l.setRequestHeader("Accept","application/json"),l.addEventListener("readystatechange",function(){var e;l.readyState===XMLHttpRequest.DONE&&(200===l.status?(e=JSON.parse(l.responseText),t(e)):n())}),l.send()}(function(e){artistIdSearched=e.artists[0].id,offset=0,mainResultDelete=document.querySelectorAll(".result-section_single"),showMore.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),spinner.style.display="block",mainResultDelete=document.querySelectorAll(".result-section_single"),setTimeout(function(){offset+=5,spinner.style.display="none",t()},5e3)},!0);for(let e=1;e<mainResultDelete.length;e++)mainResultDelete[e].remove();t()})}function searchByTitle(){const m=nameInputForm.value;function e(t,n){const l=new XMLHttpRequest;l.open("GET",'http://musicbrainz.org/ws/2/recording/?query=recording:"'+m+'"'),l.setRequestHeader("Accept","application/json"),l.addEventListener("readystatechange",function(){var e;l.readyState===XMLHttpRequest.DONE&&(200===l.status?(e=JSON.parse(l.responseText),t(e)):n())}),l.send()}function t(){showMoreDiv.style.display="block",e(function(a){resultNumber.textContent=a.count+" résultats";for(let c=0;c<a.recordings.length;c++){number++;let e=childCopy;e=mainResult.cloneNode(!0);let t=e.children[4].children[0],n=e.children[4].children[1],l=e.children[4].children[1].firstElementChild,r=document.createElement("span");r.classList.add("closing"),l.appendChild(r);let s=document.createElement("p");s.textContent="Titre: "+m,l.appendChild(s);let o=document.createElement("p");l.appendChild(o);let i=document.createElement("p");var d=a.recordings[c].length;i.textContent="Length: "+(u=d,Math.floor(u/60)+":"+u%60),l.appendChild(i),e.children[0].textContent=number,e.children[1].textContent=a.recordings[c]["artist-credit"][0].name,e.children[2].textContent=a.recordings[c].title,albumId=a.recordings[c].releases[0],null==albumId?e.children[3].textContent="Album inconnu":(albumId=a.recordings[c].releases[0],e.children[3].textContent=a.recordings[c].releases[0].title,o.textContent="Album: "+a.recordings[c].releases[0].title),r.onclick=function(){n.style.display="none"},window.onclick=function(e){e.target==n&&(n.style.display="none")},t.onclick=function(e){e.preventDefault(),n.style.display="block"},idSingle=a.recordings[c].id,albumId=a.recordings[c].releases[0].id,o.textContent="Album: "+a.recordings[c].releases[0].title,function(t,n){const l=new XMLHttpRequest;l.open("GET","http://coverartarchive.org/release/"+albumId+"/"),l.setRequestHeader("Accept","application/json"),l.addEventListener("readystatechange",function(){var e;l.readyState===XMLHttpRequest.DONE&&200===l.status&&(200===l.status?(e=JSON.parse(l.responseText),t(e)):n())}),l.send()}(function(n){for(let t=0;t<n.images.length;t++){let e=document.createElement("img");e.classList.add("image-album"),e.src=n.images[t].image,l.appendChild(e)}}),resultSection.appendChild(e)}var u})}e(function(e){mainResultDelete=document.querySelectorAll(".result-section_single"),handler=function(e){e.preventDefault(),spinner.style.display="block",mainResultDelete=document.querySelectorAll(".result-section_single"),setTimeout(function(){offset+=10,spinner.style.display="none",t()},3e3)},showMore.removeEventListener("click",handler),showMore.addEventListener("click",handler,!0);for(let e=1;e<mainResultDelete.length;e++)mainResultDelete[e].remove();offset=0,t()})}function searchByAlbum(){const p=nameInputForm.value;function e(t,n){const l=new XMLHttpRequest;l.open("GET",'http://musicbrainz.org/ws/2/release/?query=recording:"'+p+'"'),l.setRequestHeader("Accept","application/json"),l.addEventListener("readystatechange",function(){var e;l.readyState===XMLHttpRequest.DONE&&(200===l.status?(e=JSON.parse(l.responseText),t(e)):n())}),l.send()}function t(){showMoreDiv.style.display="block",e(function(d){resultNumber.textContent=d.count+" résultats";for(let a=0;a<d.releases.length;a++){number++;let e=childCopy;e=mainResult.cloneNode(!0);let t=e.children[4].children[0],n=e.children[4].children[1],l=e.children[4].children[1].firstElementChild,r=document.createElement("span");r.classList.add("closing"),l.appendChild(r);let s=document.createElement("p");s.textContent="Titre: "+p,l.appendChild(s);let o=document.createElement("p");o.textContent="Note: "+d.releases[a].score+"/100",l.appendChild(o);let i=document.createElement("p");l.appendChild(i);let c=document.createElement("p");var u=d.releases[a].length;c.textContent="Length: "+(m=u,Math.floor(m/60)+":"+m%60),l.appendChild(c),e.children[0].textContent=number,e.children[1].textContent=d.releases[a]["artist-credit"][0].name,e.children[2].textContent=p,e.children[3].textContent=d.releases[a].title,r.onclick=function(){n.style.display="none"},window.onclick=function(e){e.target==n&&(n.style.display="none")},t.onclick=function(e){e.preventDefault(),n.style.display="block"},albumId=d.releases[a].id,void 0!==d.releases[a]?e.children[3].textContent=d.releases[a].title:childCopy.children[3].textContent="Album inconnu",i.textContent="Album: "+d.releases[a].title,function(t,n){const l=new XMLHttpRequest;l.open("GET","http://coverartarchive.org/release/"+albumId+"/"),l.setRequestHeader("Accept","application/json"),l.addEventListener("readystatechange",function(){var e;l.readyState===XMLHttpRequest.DONE&&200===l.status&&(200===l.status?(e=JSON.parse(l.responseText),t(e)):n())}),l.send()}(function(n){for(let t=0;t<n.images.length;t++){let e=document.createElement("img");e.classList.add("image-album"),e.src=n.images[t].image,l.appendChild(e)}}),resultSection.appendChild(e)}var m})}e(function(e){mainResultDelete=document.querySelectorAll(".result-section_single"),handler=function(e){e.preventDefault(),spinner.style.display="block",mainResultDelete=document.querySelectorAll(".result-section_single"),setTimeout(function(){offset+=10,spinner.style.display="none",t()},3e3)},showMore.removeEventListener("click",handler),showMore.addEventListener("click",handler,!0);for(let e=1;e<mainResultDelete.length;e++)mainResultDelete[e].remove();offset=0,t()})}form.addEventListener("submit",function(e){number=0,e.preventDefault(),"album"===select.value?searchByAlbum():"title"===select.value?searchByTitle():"artist"===select.value&&searchByArtist()});