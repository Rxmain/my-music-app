let nameInputForm=document.querySelector(".user-search"),form=document.querySelector("form");function enterSubmit(){form.addEventListener("keypress",function(e){e.preventDefault(),13==e.key&&e.preventDefault()})}const result=document.querySelector(".result-section"),resultNumber=document.querySelector(".result-section_counter"),userInput=document.querySelector(".user-search").value,select=document.querySelector("select"),selectBoxArtist=document.querySelector("select").value="artist",selectBoxTitle=document.querySelector("select").value="title",selectBoxAlbum=document.querySelector("select").value="album";let spinner=document.querySelector(".spinner"),resultSection=document.querySelector(".result-section"),mainResult=document.querySelector(".result-section_single"),idResult=document.querySelector(".id-single"),artistContent=document.querySelector(".artist-name"),titleContent=document.querySelector(".artist-single"),artistIdSearched="",showMoreDiv=document.querySelector(".more-btn"),showMore=document.querySelector(".show-more-btn"),offset=0;var handler;let mainResultDelete,childCopy,number=0,idSingle="",albumId="";function searchByArtist(){const h=nameInputForm.value;function t(){showMoreDiv.style.display="block",number=0,function(t,n){const r=new XMLHttpRequest;r.open("GET","https://musicbrainz.org/ws/2/recording?fmt=json&limit=5&offset="+offset+"&artist="+artistIdSearched+"&inc=genres"),r.addEventListener("readystatechange",function(){var e;r.readyState===XMLHttpRequest.DONE&&(200===r.status?(e=JSON.parse(r.responseText),t(e)):n())}),r.send()}(function(a){resultNumber.textContent=a["recording-count"]+" résultats";for(let u=0;u<a.recordings.length;u++){console.log(a),number++;let t=childCopy;t=mainResult.cloneNode(!0);let e=t.children[4].children[0],n=t.children[4].children[1],r=t.children[4].children[1].firstElementChild,s=document.createElement("span");s.classList.add("closing"),r.appendChild(s);let l=document.createElement("p");l.textContent="Artist: "+h,r.appendChild(l);let o=document.createElement("p");void 0!==a.recordings[u].genres[0]?o.textContent="Genre: "+a.recordings[u].genres[0].name:o.textContent="Genre: Inconnu",r.appendChild(o);let c=document.createElement("p");r.appendChild(c);let i=document.createElement("p");var d=a.recordings[u].length;i.textContent="Length: "+(m=d,p=void 0,p=Math.floor(m/6e4),m=(m%6e4/1e3).toFixed(0),p+":"+(m<10?"0":"")+m),r.appendChild(i),t.children[0].textContent=number,t.children[1].textContent=h,t.children[2].textContent=a.recordings[u].title,s.onclick=function(){n.style.display="none"},window.onclick=function(e){e.target==n&&(n.style.display="none")},e.onclick=function(e){e.preventDefault(),n.style.display="block"},idSingle=a.recordings[u].id,function(t,n){const r=new XMLHttpRequest;r.open("GET","https://musicbrainz.org/ws/2/release?fmt=json&limit=5&offset=&recording="+idSingle),r.addEventListener("readystatechange",function(){var e;r.readyState===XMLHttpRequest.DONE&&(200===r.status?(e=JSON.parse(r.responseText),t(e)):n())}),r.send()}(function(e){albumId=e.releases[0].id,void 0!==e.releases[0]?t.children[3].textContent=e.releases[0].title:childCopy.children[3].textContent="Album inconnu",c.textContent="Album: "+e.releases[0].title,function(t){const n=new XMLHttpRequest;n.open("GET","http://coverartarchive.org/release/"+albumId+"/"),n.setRequestHeader("Accept","application/json"),n.addEventListener("readystatechange",function(){var e;n.readyState===XMLHttpRequest.DONE&&(200===n.status?(e=JSON.parse(n.responseText),t(e)):window.alert("Un problème est survenu"))}),n.send()}(function(n){for(let t=0;t<n.images.length;t++){let e=document.createElement("img");e.classList.add("image-album"),e.src=n.images[t].image,r.appendChild(e)}})}),resultSection.appendChild(t)}var m,p})}!function(t,n){const r=new XMLHttpRequest;r.open("GET",'http://musicbrainz.org/ws/2/artist/?query=artist:"'+h+'"'),r.setRequestHeader("Accept","application/json"),r.addEventListener("readystatechange",function(){var e;r.readyState===XMLHttpRequest.DONE&&(200===r.status?(e=JSON.parse(r.responseText),t(e)):n())}),r.send()}(function(e){artistIdSearched=e.artists[0].id,mainResultDelete=document.querySelectorAll(".result-section_single"),handler=function(e){e.preventDefault(),spinner.style.display="block",mainResultDelete=document.querySelectorAll(".result-section_single"),setTimeout(function(){offset+=10,spinner.style.display="none",t()},3e3)},showMore.removeEventListener("click",handler),showMore.addEventListener("click",handler,!0);for(let e=1;e<mainResultDelete.length;e++)mainResultDelete[e].remove();offset=0,t()})}form.addEventListener("submit",function(e){e.preventDefault(),"album"===select.value?searchByAlbum():"title"===select.value?searchByTitle():"artist"===select.value&&searchByArtist()});